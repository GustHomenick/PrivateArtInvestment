<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Art Investment Platform - FHE Encrypted Art Investment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .card {
            background: linear-gradient(145deg, #1e2a3a, #253447);
            border: 1px solid rgba(83, 217, 217, 0.2);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }

        .card h3 {
            color: #53d9d9;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #a0d8d8;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            background: rgba(15, 52, 96, 0.4);
            border: 2px solid rgba(83, 217, 217, 0.3);
            border-radius: 10px;
            font-size: 16px;
            color: #e0e0e0;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #53d9d9;
            background: rgba(15, 52, 96, 0.6);
        }

        .btn {
            background: linear-gradient(135deg, #53d9d9 0%, #00bfa5 100%);
            color: #0f1419;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(83, 217, 217, 0.4);
            background: linear-gradient(135deg, #6ee7e7 0%, #00d4b8 100%);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status.success {
            background: rgba(0, 191, 165, 0.2);
            color: #6ee7e7;
            border: 2px solid #00bfa5;
        }

        .status.error {
            background: rgba(255, 82, 82, 0.2);
            color: #ff8a8a;
            border: 2px solid #ff5252;
        }

        .status.info {
            background: rgba(83, 217, 217, 0.2);
            color: #a0d8d8;
            border: 2px solid #53d9d9;
        }

        .artwork-gallery {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .artworks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .artwork-card {
            background: linear-gradient(145deg, #1a2332, #212d3f);
            border: 1px solid rgba(83, 217, 217, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .artwork-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(83, 217, 217, 0.3);
            border-color: rgba(83, 217, 217, 0.5);
        }

        .artwork-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #0f3460, #16213e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #53d9d9;
            font-size: 3em;
        }

        .artwork-info {
            padding: 20px;
        }

        .artwork-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #e0e0e0;
        }

        .artwork-artist {
            color: #a0d8d8;
            margin-bottom: 15px;
        }

        .artwork-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: #53d9d9;
        }

        .stat-label {
            color: #8aa4a4;
        }

        .invest-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #00bfa5 0%, #00897b 100%);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .invest-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 191, 165, 0.3);
            background: linear-gradient(135deg, #00d4b8 0%, #009688 100%);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: rgba(15, 52, 96, 0.3);
            border: 1px solid rgba(83, 217, 217, 0.2);
            color: #a0d8d8;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:first-child {
            border-radius: 10px 0 0 10px;
        }

        .tab:last-child {
            border-radius: 0 10px 10px 0;
        }

        .tab.active {
            background: linear-gradient(135deg, #53d9d9 0%, #00bfa5 100%);
            color: #0f1419;
            border-color: #53d9d9;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            color: white;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 14px;
        }

        .connected {
            background: rgba(72, 187, 120, 0.8);
        }

        .privacy-badge {
            background: rgba(83, 217, 217, 0.15);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #a0d8d8;
            border: 1px solid rgba(83, 217, 217, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Not Connected</div>

    <div class="container">
        <div class="header">
            <h1>üé® Private Art Investment Platform</h1>
            <p>Privacy-Protected Art Collection Investment Using FHE Encryption Technology</p>
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.9em;">
                <strong>üîê FHE Privacy Features:</strong>
                <br>‚Ä¢ Investment amounts fully encrypted
                <br>‚Ä¢ Share quantities privacy protected
                <br>‚Ä¢ Portfolio data encrypted computation
                <br>‚Ä¢ Homomorphic encryption ensures data never leaks
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalArtworks">0</div>
                <div>Total Artworks</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalInvestors">0</div>
                <div>Total Investors</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="userPortfolio">0</div>
                <div>My Portfolio</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <h3>üë§ Investor Registration</h3>

                <div class="tabs">
                    <div class="tab active" onclick="showTab('register')">Register Investor</div>
                    <div class="tab" onclick="showTab('invest')">Private Investment</div>
                </div>

                <div class="tab-content active" id="register">
                    <div class="form-group">
                        <button class="btn" onclick="registerInvestor()">Register as Investor</button>
                    </div>
                    <div id="registerStatus"></div>
                </div>

                <div class="tab-content" id="invest">
                    <div class="privacy-badge">
                        <strong>üîê Privacy Protected Investment</strong><br>
                        Your investment amount and share quantities will be fully encrypted using FHE technology, ensuring investment privacy.
                    </div>
                    <div class="form-group">
                        <label>Select Artwork:</label>
                        <select id="artworkSelect">
                            <option value="">Choose artwork to invest in...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Investment Shares üîê:</label>
                        <input type="number" id="shareAmount" placeholder="Enter number of shares to purchase (will be encrypted)" min="1">
                    </div>
                    <div class="form-group">
                        <label>Investment Amount (ETH) üîê:</label>
                        <input type="text" id="investmentAmount" placeholder="Will be calculated automatically (encrypted storage)" readonly>
                    </div>
                    <div class="form-group">
                        <button class="btn" onclick="makeInvestment()">üîê Make Private Investment</button>
                    </div>
                    <div id="investStatus"></div>
                </div>
            </div>

            <div class="card">
                <h3>üé≠ Artwork Management</h3>

                <div class="form-group">
                    <label>Artwork Name:</label>
                    <input type="text" id="artworkName" placeholder="Enter artwork name">
                </div>
                <div class="form-group">
                    <label>Artist:</label>
                    <input type="text" id="artistName" placeholder="Enter artist name">
                </div>
                <div class="form-group">
                    <label>IPFS Hash:</label>
                    <input type="text" id="ipfsHash" placeholder="Enter artwork IPFS hash">
                </div>
                <div class="form-group">
                    <label>Total Value (ETH):</label>
                    <input type="number" id="totalValue" placeholder="0.0" step="0.001">
                </div>
                <div class="form-group">
                    <label>Share Price (ETH):</label>
                    <input type="number" id="sharePrice" placeholder="0.0" step="0.001">
                </div>
                <div class="form-group">
                    <label>Total Shares:</label>
                    <input type="number" id="totalShares" placeholder="100" min="1">
                </div>
                <div class="form-group">
                    <button class="btn" onclick="listArtwork()">List Artwork</button>
                </div>
                <div id="listingStatus"></div>
            </div>
        </div>

        <div class="card artwork-gallery">
            <h3>üé® Artwork Gallery</h3>
            <div class="artworks-grid" id="artworksGrid">
                <div class="artwork-card">
                    <div class="artwork-image">üé®</div>
                    <div class="artwork-info">
                        <div class="artwork-title">No Artworks Yet</div>
                        <div class="artwork-artist">Please list artworks first</div>
                        <div class="artwork-stats">
                            <div class="stat">
                                <div class="stat-value">-</div>
                                <div class="stat-label">Total Value</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">-</div>
                                <div class="stat-label">Available Shares</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">-</div>
                                <div class="stat-label">Investors</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
    <script>
        let provider;
        let signer;
        let contract;
        let userAddress;

        // Replace with actual deployed contract address
        const CONTRACT_ADDRESS = "0xa0eE56B7697846877d0E90FA654377dcDD68Aaa8";
        const CONTRACT_ABI = [
            "function registerInvestor() external",
            "function listArtwork(string memory _name, string memory _artist, string memory _ipfsHash, uint256 _totalValue, uint256 _sharePrice, uint256 _totalShares) external",
            "function makePrivateInvestment(uint256 artworkId, uint32 shareAmount) external payable",
            "function requestReturnsDistribution(uint256 artworkId) external payable",
            "function getArtworkInfo(uint256 artworkId) external view returns (string memory name, string memory artist, string memory ipfsHash, uint256 totalValue, uint256 sharePrice, uint256 totalShares, uint256 availableShares, uint256 investorCount)",
            "function getTotalStats() external view returns (uint256 totalArtworksListed, uint256 totalRegisteredInvestors)",
            "function isInvestorRegistered(address investor) external view returns (bool)",
            "function getInvestmentStatus(address investor, uint256 artworkId) external view returns (bool hasInvested, uint256 timestamp)",
            "function owner() external view returns (address)",
            "event ArtworkListed(uint256 indexed artworkId, string name, uint256 totalValue, uint256 sharePrice)",
            "event PrivateInvestmentMade(address indexed investor, uint256 indexed artworkId, uint256 timestamp)",
            "event InvestorRegistered(address indexed investor, uint256 timestamp)",
            "event ReturnsDistributed(uint256 indexed artworkId, uint256 totalReturns)"
        ];

        async function initWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = await provider.getSigner();
                    userAddress = await signer.getAddress();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                    updateConnectionStatus(true);
                    await loadStats();
                    await loadArtworks();
                } catch (error) {
                    console.error("Wallet connection failed:", error);
                    showStatus('registerStatus', `Connection failed: ${error.message}`, 'error');
                }
            } else {
                showStatus('registerStatus', 'Please install MetaMask wallet', 'error');
            }
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            if (connected) {
                statusElement.textContent = `Connected: ${userAddress?.substring(0, 6)}...${userAddress?.substring(38)}`;
                statusElement.className = 'connection-status connected';
            } else {
                statusElement.textContent = 'Not Connected';
                statusElement.className = 'connection-status';
            }
        }

        async function registerInvestor() {
            try {
                if (!contract) {
                    await initWeb3();
                }

                showStatus('registerStatus', 'Registering investor...', 'info');

                const isRegistered = await contract.isInvestorRegistered(userAddress);
                if (isRegistered) {
                    showStatus('registerStatus', 'You are already a registered investor', 'info');
                    return;
                }

                const tx = await contract.registerInvestor();
                showStatus('registerStatus', `Transaction submitted: ${tx.hash}`, 'info');

                await tx.wait();
                showStatus('registerStatus', 'Investor registration successful!', 'success');

                await loadStats();
            } catch (error) {
                console.error('Registration failed:', error);
                showStatus('registerStatus', `Registration failed: ${error.message}`, 'error');
            }
        }

        async function listArtwork() {
            try {
                if (!contract) {
                    await initWeb3();
                }

                const name = document.getElementById('artworkName').value;
                const artist = document.getElementById('artistName').value;
                const ipfsHash = document.getElementById('ipfsHash').value;
                const totalValue = document.getElementById('totalValue').value;
                const sharePrice = document.getElementById('sharePrice').value;
                const totalShares = document.getElementById('totalShares').value;

                if (!name || !artist || !ipfsHash || !totalValue || !sharePrice || !totalShares) {
                    showStatus('listingStatus', 'Please fill all fields', 'error');
                    return;
                }

                const totalValueWei = ethers.parseEther(totalValue);
                const sharePriceWei = ethers.parseEther(sharePrice);

                showStatus('listingStatus', 'Listing artwork...', 'info');

                const tx = await contract.listArtwork(name, artist, ipfsHash, totalValueWei, sharePriceWei, totalShares);
                showStatus('listingStatus', `Transaction submitted: ${tx.hash}`, 'info');

                await tx.wait();
                showStatus('listingStatus', 'Artwork listed successfully!', 'success');

                clearArtworkForm();
                await loadStats();
                await loadArtworks();
            } catch (error) {
                console.error('Listing failed:', error);
                showStatus('listingStatus', `Listing failed: ${error.message}`, 'error');
            }
        }

        async function makeInvestment() {
            try {
                if (!contract) {
                    await initWeb3();
                }

                const artworkId = document.getElementById('artworkSelect').value;
                const shareAmount = document.getElementById('shareAmount').value;

                if (!artworkId || !shareAmount) {
                    showStatus('investStatus', 'Please select artwork and enter share amount', 'error');
                    return;
                }

                const isRegistered = await contract.isInvestorRegistered(userAddress);
                if (!isRegistered) {
                    showStatus('investStatus', 'Please register as investor first', 'error');
                    return;
                }

                showStatus('investStatus', 'Making investment...', 'info');

                const artworkInfo = await contract.getArtworkInfo(artworkId);
                const investmentValue = artworkInfo.sharePrice * BigInt(shareAmount);

                const tx = await contract.makePrivateInvestment(artworkId, shareAmount, {
                    value: investmentValue
                });

                showStatus('investStatus', `Transaction submitted: ${tx.hash}`, 'info');

                await tx.wait();
                showStatus('investStatus', 'Investment successful!', 'success');

                clearInvestmentForm();
                await loadStats();
                await loadArtworks();
            } catch (error) {
                console.error('Investment failed:', error);
                showStatus('investStatus', `Investment failed: ${error.message}`, 'error');
            }
        }

        async function loadStats() {
            try {
                if (!contract) return;

                const [totalArtworks, totalInvestors] = await contract.getTotalStats();

                document.getElementById('totalArtworks').textContent = totalArtworks.toString();
                document.getElementById('totalInvestors').textContent = totalInvestors.toString();

                // In FHE version, portfolio data is encrypted, show as privacy protected
                if (userAddress) {
                    try {
                        const isRegistered = await contract.isInvestorRegistered(userAddress);
                        if (isRegistered) {
                            document.getElementById('userPortfolio').textContent = 'üîê'; // Show encrypted state
                        } else {
                            document.getElementById('userPortfolio').textContent = '0';
                        }
                    } catch (error) {
                        console.error('Failed to get user portfolio:', error);
                        document.getElementById('userPortfolio').textContent = '0';
                    }
                } else {
                    document.getElementById('userPortfolio').textContent = '0';
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        async function loadArtworks() {
            try {
                if (!contract) return;

                const [totalArtworks] = await contract.getTotalStats();
                const artworksGrid = document.getElementById('artworksGrid');
                const artworkSelect = document.getElementById('artworkSelect');

                artworksGrid.innerHTML = '';
                artworkSelect.innerHTML = '<option value="">Choose artwork to invest in...</option>';

                for (let i = 0; i < totalArtworks; i++) {
                    try {
                        const artworkInfo = await contract.getArtworkInfo(i);

                        const artworkCard = createArtworkCard(i, artworkInfo);
                        artworksGrid.appendChild(artworkCard);

                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `${artworkInfo.name} - ${ethers.formatEther(artworkInfo.sharePrice)} ETH/share`;
                        artworkSelect.appendChild(option);
                    } catch (error) {
                        console.error(`Failed to load artwork ${i}:`, error);
                    }
                }
            } catch (error) {
                console.error('Failed to load artworks:', error);
            }
        }

        function createArtworkCard(id, info) {
            const card = document.createElement('div');
            card.className = 'artwork-card';

            const totalValue = ethers.formatEther(info.totalValue);
            const sharePrice = ethers.formatEther(info.sharePrice);

            card.innerHTML = `
                <div class="artwork-image">üé®</div>
                <div class="artwork-info">
                    <div class="artwork-title">${info.name}</div>
                    <div class="artwork-artist">by ${info.artist}</div>
                    <div class="artwork-stats">
                        <div class="stat">
                            <div class="stat-value">${totalValue} ETH</div>
                            <div class="stat-label">Total Value</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${info.availableShares.toString()}</div>
                            <div class="stat-label">Available Shares</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${info.investorCount.toString()}</div>
                            <div class="stat-label">Investors</div>
                        </div>
                    </div>
                    <button class="invest-btn" onclick="selectArtworkForInvestment(${id})">
                        Invest (${sharePrice} ETH/share)
                    </button>
                </div>
            `;

            return card;
        }

        function selectArtworkForInvestment(artworkId) {
            document.getElementById('artworkSelect').value = artworkId;
            showTab('invest');

            // Auto calculate investment amount
            calculateInvestmentAmount();
        }

        async function calculateInvestmentAmount() {
            const artworkId = document.getElementById('artworkSelect').value;
            const shareAmount = document.getElementById('shareAmount').value;

            if (artworkId && shareAmount && contract) {
                try {
                    const artworkInfo = await contract.getArtworkInfo(artworkId);
                    const totalAmount = artworkInfo.sharePrice * BigInt(shareAmount);
                    const formattedAmount = ethers.formatEther(totalAmount);

                    document.getElementById('investmentAmount').value = formattedAmount + ' ETH';
                } catch (error) {
                    console.error('Failed to calculate investment amount:', error);
                }
            }
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearArtworkForm() {
            document.getElementById('artworkName').value = '';
            document.getElementById('artistName').value = '';
            document.getElementById('ipfsHash').value = '';
            document.getElementById('totalValue').value = '';
            document.getElementById('sharePrice').value = '';
            document.getElementById('totalShares').value = '';
        }

        function clearInvestmentForm() {
            document.getElementById('artworkSelect').value = '';
            document.getElementById('shareAmount').value = '';
            document.getElementById('investmentAmount').value = '';
        }

        // Event listeners
        document.getElementById('shareAmount').addEventListener('input', calculateInvestmentAmount);
        document.getElementById('artworkSelect').addEventListener('change', calculateInvestmentAmount);

        // Initialize on page load
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                // Listen for account changes
                window.ethereum.on('accountsChanged', () => {
                    window.location.reload();
                });

                // Listen for network changes
                window.ethereum.on('chainChanged', () => {
                    window.location.reload();
                });

                await initWeb3();
            }
        });

        // Periodic data updates
        setInterval(async () => {
            if (contract) {
                await loadStats();
                await loadArtworks();
            }
        }, 30000); // Update every 30 seconds
    </script>
</body>
</html>