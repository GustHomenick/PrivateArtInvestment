<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ¿åè‰ºæœ¯å“æŠ•èµ„å¹³å° - éšç§è‰ºæœ¯æ”¶è—æŠ•èµ„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card h3 {
            color: #5a67d8;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #9ae6b4;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #fc8181;
        }

        .status.info {
            background: #bee3f8;
            color: #2a4365;
            border: 2px solid #63b3ed;
        }

        .artwork-gallery {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .artworks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .artwork-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .artwork-card:hover {
            transform: translateY(-5px);
        }

        .artwork-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f2f5, #e2e8f0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #718096;
            font-size: 3em;
        }

        .artwork-info {
            padding: 20px;
        }

        .artwork-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2d3748;
        }

        .artwork-artist {
            color: #718096;
            margin-bottom: 15px;
        }

        .artwork-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: #5a67d8;
        }

        .stat-label {
            color: #718096;
        }

        .invest-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .invest-btn:hover {
            transform: translateY(-1px);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:first-child {
            border-radius: 10px 0 0 10px;
        }

        .tab:last-child {
            border-radius: 0 10px 10px 0;
        }

        .tab.active {
            background: #5a67d8;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            color: white;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 14px;
        }

        .connected {
            background: rgba(72, 187, 120, 0.8);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">æœªè¿æ¥</div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¨ åŒ¿åè‰ºæœ¯å“æŠ•èµ„å¹³å°</h1>
            <p>éšç§ä¿æŠ¤çš„è‰ºæœ¯æ”¶è—å“æŠ•èµ„ï¼ŒåŸºäºFHEåŒæ€åŠ å¯†æŠ€æœ¯</p>
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.9em;">
                <strong>ğŸ” FHEéšç§ä¿æŠ¤ç‰¹æ€§ï¼š</strong>
                <br>â€¢ æŠ•èµ„é‡‘é¢å®Œå…¨åŠ å¯†å­˜å‚¨
                <br>â€¢ æŒè‚¡æ•°é‡éšç§ä¿æŠ¤
                <br>â€¢ æŠ•èµ„ç»„åˆæ•°æ®åŠ å¯†è®¡ç®—
                <br>â€¢ åŒæ€åŠ å¯†ç¡®ä¿æ•°æ®æ°¸ä¸æ³„éœ²
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalArtworks">0</div>
                <div>è‰ºæœ¯å“æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalInvestors">0</div>
                <div>æŠ•èµ„è€…æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="userPortfolio">0</div>
                <div>æˆ‘çš„æŠ•èµ„ç»„åˆ</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <h3>ğŸ‘¤ æŠ•èµ„è€…æ³¨å†Œ</h3>

                <div class="tabs">
                    <div class="tab active" onclick="showTab('register')">æ³¨å†ŒæŠ•èµ„è€…</div>
                    <div class="tab" onclick="showTab('invest')">ç§å¯†æŠ•èµ„</div>
                </div>

                <div class="tab-content active" id="register">
                    <div class="form-group">
                        <button class="btn" onclick="registerInvestor()">æ³¨å†Œä¸ºæŠ•èµ„è€…</button>
                    </div>
                    <div id="registerStatus"></div>
                </div>

                <div class="tab-content" id="invest">
                    <div style="background: #e6f3ff; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.85em; color: #2c5aa0;">
                        <strong>ğŸ” éšç§ä¿æŠ¤æŠ•èµ„</strong><br>
                        æ‚¨çš„æŠ•èµ„é‡‘é¢å’ŒæŒè‚¡æ•°é‡å°†é€šè¿‡FHEæŠ€æœ¯å®Œå…¨åŠ å¯†ï¼Œç¡®ä¿æŠ•èµ„éšç§ã€‚
                    </div>
                    <div class="form-group">
                        <label>é€‰æ‹©è‰ºæœ¯å“:</label>
                        <select id="artworkSelect">
                            <option value="">é€‰æ‹©è¦æŠ•èµ„çš„è‰ºæœ¯å“...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æŠ•èµ„ä»½é¢ ğŸ”:</label>
                        <input type="number" id="shareAmount" placeholder="è¾“å…¥è¦è´­ä¹°çš„ä»½é¢æ•°é‡ï¼ˆå°†è¢«åŠ å¯†ï¼‰" min="1">
                    </div>
                    <div class="form-group">
                        <label>æŠ•èµ„é‡‘é¢ (ETH) ğŸ”:</label>
                        <input type="text" id="investmentAmount" placeholder="å°†è‡ªåŠ¨è®¡ç®—ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰" readonly>
                    </div>
                    <div class="form-group">
                        <button class="btn" onclick="makeInvestment()">ğŸ” è¿›è¡Œç§å¯†æŠ•èµ„</button>
                    </div>
                    <div id="investStatus"></div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ­ è‰ºæœ¯å“ç®¡ç†</h3>

                <div class="form-group">
                    <label>è‰ºæœ¯å“åç§°:</label>
                    <input type="text" id="artworkName" placeholder="è¾“å…¥è‰ºæœ¯å“åç§°">
                </div>
                <div class="form-group">
                    <label>è‰ºæœ¯å®¶:</label>
                    <input type="text" id="artistName" placeholder="è¾“å…¥è‰ºæœ¯å®¶åç§°">
                </div>
                <div class="form-group">
                    <label>IPFSå“ˆå¸Œ:</label>
                    <input type="text" id="ipfsHash" placeholder="è¾“å…¥è‰ºæœ¯å“IPFSå“ˆå¸Œ">
                </div>
                <div class="form-group">
                    <label>æ€»ä»·å€¼ (ETH):</label>
                    <input type="number" id="totalValue" placeholder="0.0" step="0.001">
                </div>
                <div class="form-group">
                    <label>æ¯è‚¡ä»·æ ¼ (ETH):</label>
                    <input type="number" id="sharePrice" placeholder="0.0" step="0.001">
                </div>
                <div class="form-group">
                    <label>æ€»è‚¡æ•°:</label>
                    <input type="number" id="totalShares" placeholder="100" min="1">
                </div>
                <div class="form-group">
                    <button class="btn" onclick="listArtwork()">ä¸Šæ¶è‰ºæœ¯å“</button>
                </div>
                <div id="listingStatus"></div>
            </div>
        </div>

        <div class="card artwork-gallery">
            <h3>ğŸ¨ è‰ºæœ¯å“ç”»å»Š</h3>
            <div class="artworks-grid" id="artworksGrid">
                <div class="artwork-card">
                    <div class="artwork-image">ğŸ¨</div>
                    <div class="artwork-info">
                        <div class="artwork-title">æš‚æ— è‰ºæœ¯å“</div>
                        <div class="artwork-artist">è¯·å…ˆä¸Šæ¶è‰ºæœ¯å“</div>
                        <div class="artwork-stats">
                            <div class="stat">
                                <div class="stat-value">-</div>
                                <div class="stat-label">æ€»ä»·å€¼</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">-</div>
                                <div class="stat-label">å¯ç”¨è‚¡æ•°</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">-</div>
                                <div class="stat-label">æŠ•èµ„äººæ•°</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-6.7.1.umd.min.js"></script>
    <script>
        let provider;
        let signer;
        let contract;
        let userAddress;

        const CONTRACT_ADDRESS = "0xa0eE56B7697846877d0E90FA654377dcDD68Aaa8"; // æ›¿æ¢ä¸ºå®é™…åˆçº¦åœ°å€
        const CONTRACT_ABI = [
            "function registerInvestor() external",
            "function listArtwork(string memory _name, string memory _artist, string memory _ipfsHash, uint256 _totalValue, uint256 _sharePrice, uint256 _totalShares) external",
            "function makePrivateInvestment(uint256 artworkId, uint32 shareAmount) external payable",
            "function requestReturnsDistribution(uint256 artworkId) external payable",
            "function getArtworkInfo(uint256 artworkId) external view returns (string memory name, string memory artist, string memory ipfsHash, uint256 totalValue, uint256 sharePrice, uint256 totalShares, uint256 availableShares, uint256 investorCount)",
            "function getTotalStats() external view returns (uint256 totalArtworksListed, uint256 totalRegisteredInvestors)",
            "function isInvestorRegistered(address investor) external view returns (bool)",
            "function getInvestmentStatus(address investor, uint256 artworkId) external view returns (bool hasInvested, uint256 timestamp)",
            "function owner() external view returns (address)",
            "event ArtworkListed(uint256 indexed artworkId, string name, uint256 totalValue, uint256 sharePrice)",
            "event PrivateInvestmentMade(address indexed investor, uint256 indexed artworkId, uint256 timestamp)",
            "event InvestorRegistered(address indexed investor, uint256 timestamp)",
            "event ReturnsDistributed(uint256 indexed artworkId, uint256 totalReturns)"
        ];

        async function initWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = await provider.getSigner();
                    userAddress = await signer.getAddress();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                    updateConnectionStatus(true);
                    await loadStats();
                    await loadArtworks();
                } catch (error) {
                    console.error("è¿æ¥é’±åŒ…å¤±è´¥:", error);
                    showStatus('registerStatus', `è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                showStatus('registerStatus', 'è¯·å®‰è£…MetaMaské’±åŒ…', 'error');
            }
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            if (connected) {
                statusElement.textContent = `å·²è¿æ¥: ${userAddress?.substring(0, 6)}...${userAddress?.substring(38)}`;
                statusElement.className = 'connection-status connected';
            } else {
                statusElement.textContent = 'æœªè¿æ¥';
                statusElement.className = 'connection-status';
            }
        }

        async function registerInvestor() {
            try {
                if (!contract) {
                    await initWeb3();
                }

                showStatus('registerStatus', 'æ­£åœ¨æ³¨å†ŒæŠ•èµ„è€…...', 'info');

                const isRegistered = await contract.isInvestorRegistered(userAddress);
                if (isRegistered) {
                    showStatus('registerStatus', 'æ‚¨å·²ç»æ˜¯æ³¨å†ŒæŠ•èµ„è€…', 'info');
                    return;
                }

                const tx = await contract.registerInvestor();
                showStatus('registerStatus', `äº¤æ˜“å·²æäº¤: ${tx.hash}`, 'info');

                await tx.wait();
                showStatus('registerStatus', 'æŠ•èµ„è€…æ³¨å†ŒæˆåŠŸ!', 'success');

                await loadStats();
            } catch (error) {
                console.error('æ³¨å†Œå¤±è´¥:', error);
                showStatus('registerStatus', `æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function listArtwork() {
            try {
                if (!contract) {
                    await initWeb3();
                }

                const name = document.getElementById('artworkName').value;
                const artist = document.getElementById('artistName').value;
                const ipfsHash = document.getElementById('ipfsHash').value;
                const totalValue = document.getElementById('totalValue').value;
                const sharePrice = document.getElementById('sharePrice').value;
                const totalShares = document.getElementById('totalShares').value;

                if (!name || !artist || !ipfsHash || !totalValue || !sharePrice || !totalShares) {
                    showStatus('listingStatus', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                    return;
                }

                const totalValueWei = ethers.parseEther(totalValue);
                const sharePriceWei = ethers.parseEther(sharePrice);

                showStatus('listingStatus', 'æ­£åœ¨ä¸Šæ¶è‰ºæœ¯å“...', 'info');

                const tx = await contract.listArtwork(name, artist, ipfsHash, totalValueWei, sharePriceWei, totalShares);
                showStatus('listingStatus', `äº¤æ˜“å·²æäº¤: ${tx.hash}`, 'info');

                await tx.wait();
                showStatus('listingStatus', 'è‰ºæœ¯å“ä¸Šæ¶æˆåŠŸ!', 'success');

                clearArtworkForm();
                await loadStats();
                await loadArtworks();
            } catch (error) {
                console.error('ä¸Šæ¶å¤±è´¥:', error);
                showStatus('listingStatus', `ä¸Šæ¶å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function makeInvestment() {
            try {
                if (!contract) {
                    await initWeb3();
                }

                const artworkId = document.getElementById('artworkSelect').value;
                const shareAmount = document.getElementById('shareAmount').value;

                if (!artworkId || !shareAmount) {
                    showStatus('investStatus', 'è¯·é€‰æ‹©è‰ºæœ¯å“å’Œè¾“å…¥ä»½é¢æ•°é‡', 'error');
                    return;
                }

                const isRegistered = await contract.isInvestorRegistered(userAddress);
                if (!isRegistered) {
                    showStatus('investStatus', 'è¯·å…ˆæ³¨å†Œä¸ºæŠ•èµ„è€…', 'error');
                    return;
                }

                showStatus('investStatus', 'æ­£åœ¨è¿›è¡ŒæŠ•èµ„...', 'info');

                const artworkInfo = await contract.getArtworkInfo(artworkId);
                const investmentValue = artworkInfo.sharePrice * BigInt(shareAmount);

                const tx = await contract.makePrivateInvestment(artworkId, shareAmount, {
                    value: investmentValue
                });

                showStatus('investStatus', `äº¤æ˜“å·²æäº¤: ${tx.hash}`, 'info');

                await tx.wait();
                showStatus('investStatus', 'æŠ•èµ„æˆåŠŸ!', 'success');

                clearInvestmentForm();
                await loadStats();
                await loadArtworks();
            } catch (error) {
                console.error('æŠ•èµ„å¤±è´¥:', error);
                showStatus('investStatus', `æŠ•èµ„å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function loadStats() {
            try {
                if (!contract) return;

                const [totalArtworks, totalInvestors] = await contract.getTotalStats();

                document.getElementById('totalArtworks').textContent = totalArtworks.toString();
                document.getElementById('totalInvestors').textContent = totalInvestors.toString();

                // FHEç‰ˆæœ¬ä¸­æŠ•èµ„ç»„åˆæ•°æ®æ˜¯åŠ å¯†çš„ï¼Œæ˜¾ç¤ºä¸ºéšç§ä¿æŠ¤çŠ¶æ€
                if (userAddress) {
                    try {
                        const isRegistered = await contract.isInvestorRegistered(userAddress);
                        if (isRegistered) {
                            document.getElementById('userPortfolio').textContent = 'ğŸ”'; // æ˜¾ç¤ºåŠ å¯†çŠ¶æ€
                        } else {
                            document.getElementById('userPortfolio').textContent = '0';
                        }
                    } catch (error) {
                        console.error('è·å–ç”¨æˆ·æŠ•èµ„ç»„åˆå¤±è´¥:', error);
                        document.getElementById('userPortfolio').textContent = '0';
                    }
                } else {
                    document.getElementById('userPortfolio').textContent = '0';
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            }
        }

        async function loadArtworks() {
            try {
                if (!contract) return;

                const [totalArtworks] = await contract.getTotalStats();
                const artworksGrid = document.getElementById('artworksGrid');
                const artworkSelect = document.getElementById('artworkSelect');

                artworksGrid.innerHTML = '';
                artworkSelect.innerHTML = '<option value="">é€‰æ‹©è¦æŠ•èµ„çš„è‰ºæœ¯å“...</option>';

                for (let i = 0; i < totalArtworks; i++) {
                    try {
                        const artworkInfo = await contract.getArtworkInfo(i);

                        const artworkCard = createArtworkCard(i, artworkInfo);
                        artworksGrid.appendChild(artworkCard);

                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `${artworkInfo.name} - ${ethers.utils.formatEther(artworkInfo.sharePrice)} ETH/è‚¡`;
                        artworkSelect.appendChild(option);
                    } catch (error) {
                        console.error(`åŠ è½½è‰ºæœ¯å“ ${i} å¤±è´¥:`, error);
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è‰ºæœ¯å“å¤±è´¥:', error);
            }
        }

        function createArtworkCard(id, info) {
            const card = document.createElement('div');
            card.className = 'artwork-card';

            const totalValue = ethers.formatEther(info.totalValue);
            const sharePrice = ethers.formatEther(info.sharePrice);

            card.innerHTML = `
                <div class="artwork-image">ğŸ¨</div>
                <div class="artwork-info">
                    <div class="artwork-title">${info.name}</div>
                    <div class="artwork-artist">by ${info.artist}</div>
                    <div class="artwork-stats">
                        <div class="stat">
                            <div class="stat-value">${totalValue} ETH</div>
                            <div class="stat-label">æ€»ä»·å€¼</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${info.availableShares.toString()}</div>
                            <div class="stat-label">å¯ç”¨è‚¡æ•°</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${info.investorCount.toString()}</div>
                            <div class="stat-label">æŠ•èµ„äººæ•°</div>
                        </div>
                    </div>
                    <button class="invest-btn" onclick="selectArtworkForInvestment(${id})">
                        æŠ•èµ„ (${sharePrice} ETH/è‚¡)
                    </button>
                </div>
            `;

            return card;
        }

        function selectArtworkForInvestment(artworkId) {
            document.getElementById('artworkSelect').value = artworkId;
            showTab('invest');

            // è‡ªåŠ¨è®¡ç®—æŠ•èµ„é‡‘é¢
            calculateInvestmentAmount();
        }

        async function calculateInvestmentAmount() {
            const artworkId = document.getElementById('artworkSelect').value;
            const shareAmount = document.getElementById('shareAmount').value;

            if (artworkId && shareAmount && contract) {
                try {
                    const artworkInfo = await contract.getArtworkInfo(artworkId);
                    const totalAmount = artworkInfo.sharePrice * BigInt(shareAmount);
                    const formattedAmount = ethers.formatEther(totalAmount);

                    document.getElementById('investmentAmount').value = formattedAmount + ' ETH';
                } catch (error) {
                    console.error('è®¡ç®—æŠ•èµ„é‡‘é¢å¤±è´¥:', error);
                }
            }
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearArtworkForm() {
            document.getElementById('artworkName').value = '';
            document.getElementById('artistName').value = '';
            document.getElementById('ipfsHash').value = '';
            document.getElementById('totalValue').value = '';
            document.getElementById('sharePrice').value = '';
            document.getElementById('totalShares').value = '';
        }

        function clearInvestmentForm() {
            document.getElementById('artworkSelect').value = '';
            document.getElementById('shareAmount').value = '';
            document.getElementById('investmentAmount').value = '';
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('shareAmount').addEventListener('input', calculateInvestmentAmount);
        document.getElementById('artworkSelect').addEventListener('change', calculateInvestmentAmount);

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                // ç›‘å¬è´¦æˆ·å˜åŒ–
                window.ethereum.on('accountsChanged', () => {
                    window.location.reload();
                });

                // ç›‘å¬ç½‘ç»œå˜åŒ–
                window.ethereum.on('chainChanged', () => {
                    window.location.reload();
                });

                await initWeb3();
            }
        });

        // å®šæœŸæ›´æ–°æ•°æ®
        setInterval(async () => {
            if (contract) {
                await loadStats();
                await loadArtworks();
            }
        }, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
    </script>
</body>
</html>